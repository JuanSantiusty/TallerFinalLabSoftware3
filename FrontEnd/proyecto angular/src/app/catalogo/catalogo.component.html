<div class="container-fluid my-4">
  <div class="row g-3">

    <!-- SIDEBAR (Filtros) -->
    <div class="col-12 col-sm-2 col-md-4 col-lg-3">
      <div class="filters-section card shadow-sm">
        <div class="card-header fw-semibold">Filtros por categoría</div>
        <div class="card-body">
          <select
            class="form-control"
            [(ngModel)]="categoriaSeleccionada"
            name="categoria"
            id="servicesFilter"
            (change)="onCategoriaChange()">

            <option [ngValue]="'Todo'">Todas</option>
            <option *ngFor="let c of categorias" [ngValue]="c.id">
              {{ c.nombre }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- PRODUCTOS -->
    <div class="col-12 col-sm-10 col-md-8 col-lg-9">

      <h2 class="services-title mb-3">Nuestros Productos</h2>

      <!-- Mensaje si no hay productos -->
      <div *ngIf="productosFiltrados.length === 0" class="alert alert-info">
        No hay productos para la categoría seleccionada.
      </div>

      <!-- GRID RESPONSIVO -->
      <div *ngIf="productosFiltrados.length > 0"
           class="row row-cols-1 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 g-3">

        <div class="col" *ngFor="let p of productosFiltrados">
          <div class="card h-100 shadow-sm service-card position-relative">

            <!-- Badge “Agotado” si no disponible (por si llega alguno) -->
            <span *ngIf="!p.estado"
                  class="badge bg-danger position-absolute"
                  style="top:8px; right:8px; z-index:2;">
              Agotado
            </span>

            <img
              [src]="getImageUrl(p.imagen)"
             (error)="onImgError($event)"
              class="card-img-top"
              [alt]="'Imagen de ' + p.nombre"
              style="height:130px; object-fit:cover; border-radius:6px;">

            <div class="card-body p-2">
              <h6 class="mb-1 text-truncate" [title]="p.nombre">{{ p.nombre }}</h6>

              <span class="badge bg-secondary mb-1">
                {{ p.objCategoria?.nombre || 'Sin categoría' }}
              </span>

              <div class="fw-bold mb-1">
                {{ p.precio | currency:'COP':'symbol-narrow' }}
              </div>

              <p class="text-truncate small mb-2" [title]="p.descripcion">{{ p.descripcion }}</p>

              <!-- Botón comprar; deshabilitado si no disponible -->
              <button class="btn btn-primary btn-sm w-100"
                      [disabled]="!p.estado"
                      [attr.aria-disabled]="!p.estado">
                {{ p.estado ? 'Comprar' : 'No disponible' }}
              </button>
            </div>

          </div>
        </div>

      </div>

    </div>
  </div>
</div>
